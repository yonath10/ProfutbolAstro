---
// Header.astro
const navLinks = [
  { href: '#inicio', label: 'Inicio' },
  { href: '#servicios', label: 'Servicios' },
  { href: '#nosotros', label: 'Nosotros' },
  { href: '#contacto', label: 'Contacto' },
];
---

<header 
  id="header" 
  class="fixed top-0 left-0 right-0 z-50 transition-all duration-300 bg-white/95 backdrop-blur-md shadow-sm" 
  role="banner">
  <nav 
    class="container mx-auto px-4 lg:px-6" 
    role="navigation" 
    aria-label="Navegación principal">
    
    <div class="flex items-center justify-between h-20 lg:h-24">
      <!-- Logo / Brand -->
      <a 
        href="#inicio" 
        class="flex items-center gap-3 group focus:outline-none focus-visible:ring-2 focus-visible:ring-yellow-500 focus-visible:ring-offset-2 rounded-lg px-2 py-1 transition-transform hover:scale-105"
        aria-label="Profutbol JC - Página de inicio">
        <img 
          src="/images/profutbol.png" 
          alt="Logo de Profutbol JC" 
          width="45" 
          height="45" 
          class="h-10 w-10 lg:h-12 lg:w-12 transition-transform group-hover:rotate-6"
          loading="eager">
        <span class="text-lg lg:text-xl font-bold text-gray-900 tracking-tight group-hover:text-yellow-500 transition-colors">
          PROFUTBOL JC
        </span>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden lg:flex items-center gap-1">
        <ul class="flex items-center gap-1" role="menubar">
          {navLinks.map((link, index) => (
            <li role="none">
              <a 
                href={link.href}
                role="menuitem"
                aria-current={index === 0 ? 'page' : undefined}
                class="nav-link relative px-4 py-2 text-sm font-semibold text-gray-700 hover:text-yellow-500 rounded-lg transition-all duration-200 hover:bg-yellow-50 focus:outline-none focus-visible:ring-2 focus-visible:ring-yellow-500 focus-visible:ring-offset-2 group">
                {link.label}
                <span class="absolute bottom-1 left-1/2 -translate-x-1/2 w-0 h-0.5 bg-yellow-500 rounded-full transition-all duration-300 group-hover:w-10"></span>
              </a>
            </li>
          ))}
        </ul>

        <!-- WhatsApp Button Desktop -->
        <a 
          href="https://wa.me/573203459145" 
          target="_blank" 
          rel="noopener noreferrer"
          class="ml-4 flex items-center justify-center w-12 h-12 bg-gradient-to-br from-yellow-400 to-yellow-500 hover:from-yellow-500 hover:to-yellow-600 text-gray-900 rounded-full shadow-md hover:shadow-lg transform hover:scale-110 transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-yellow-500 focus-visible:ring-offset-2"
          aria-label="Contactar por WhatsApp - Abre en nueva ventana">
          <i class="fab fa-whatsapp text-xl" aria-hidden="true"></i>
        </a>
      </div>

      <!-- Mobile Menu Button -->
      <button 
        type="button"
        id="mobile-menu-button"
        class="lg:hidden flex items-center justify-center w-10 h-10 rounded-lg border-2 border-yellow-500 text-gray-900 hover:bg-yellow-50 transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-yellow-500 focus-visible:ring-offset-2"
        aria-controls="mobile-menu"
        aria-expanded="false"
        aria-label="Abrir menú de navegación">
        <svg 
          class="hamburger w-6 h-6 transition-transform duration-300" 
          fill="none" 
          stroke="currentColor" 
          viewBox="0 0 24 24"
          aria-hidden="true">
          <path 
            class="line-1" 
            stroke-linecap="round" 
            stroke-linejoin="round" 
            stroke-width="2" 
            d="M4 6h16" />
          <path 
            class="line-2" 
            stroke-linecap="round" 
            stroke-linejoin="round" 
            stroke-width="2" 
            d="M4 12h16" />
          <path 
            class="line-3" 
            stroke-linecap="round" 
            stroke-linejoin="round" 
            stroke-width="2" 
            d="M4 18h16" />
        </svg>
      </button>
    </div>

    <!-- Mobile Menu -->
    <div 
      id="mobile-menu"
      class="lg:hidden overflow-hidden transition-all duration-300 ease-in-out max-h-0 opacity-0"
      role="dialog"
      aria-modal="true"
      aria-labelledby="mobile-menu-title">
      
      <div class="py-4 border-t border-gray-100">
        <h2 id="mobile-menu-title" class="sr-only">Menú de navegación</h2>
        
        <ul class="flex flex-col gap-2" role="menubar">
          {navLinks.map((link, index) => (
            <li role="none">
              <a 
                href={link.href}
                role="menuitem"
                aria-current={index === 0 ? 'page' : undefined}
                class="mobile-nav-link flex items-center justify-center px-4 py-3 text-base font-semibold text-gray-700 hover:text-yellow-500 hover:bg-yellow-50 rounded-lg transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-yellow-500 focus-visible:ring-inset transform hover:scale-[1.02]">
                {link.label}
              </a>
            </li>
          ))}
        </ul>

        <!-- WhatsApp Button Mobile -->
        <div class="mt-4 pt-4 border-t border-gray-100">
          <a 
            href="https://wa.me/573203459145" 
            target="_blank" 
            rel="noopener noreferrer"
            class="flex items-center justify-center gap-3 w-full px-6 py-4 bg-gradient-to-r from-yellow-400 to-yellow-500 hover:from-yellow-500 hover:to-yellow-600 text-gray-900 font-bold rounded-lg shadow-md hover:shadow-lg transform hover:scale-[1.02] transition-all duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-yellow-500 focus-visible:ring-offset-2"
            aria-label="Contactar por WhatsApp - Abre en nueva ventana">
            <i class="fab fa-whatsapp text-2xl" aria-hidden="true"></i>
            <span>Contáctanos por WhatsApp</span>
          </a>
        </div>
      </div>
    </div>
  </nav>
</header>

<!-- Spacer para compensar el header fixed -->
<div class="h-20 lg:h-24" aria-hidden="true"></div>

<style>
  /* Animación del header al hacer scroll */
  #header.scrolled {
     @apply shadow-md;
    background-color: rgba(255, 255, 255, 0.98);
  }

  /* Animación del menú hamburguesa */
  #mobile-menu-button[aria-expanded="true"] .hamburger {
    @apply rotate-90;
  }

  #mobile-menu-button[aria-expanded="true"] .line-1 {
    transform: rotate(45deg) translate(5px, 5px);
  }

  #mobile-menu-button[aria-expanded="true"] .line-2 {
    opacity: 0;
  }

  #mobile-menu-button[aria-expanded="true"] .line-3 {
    transform: rotate(-45deg) translate(7px, -6px);
  }

  /* Animación stagger para los items del menú móvil */
  .mobile-nav-link {
    animation: slideInFromRight 0.3s ease-out backwards;
  }

  .mobile-nav-link:nth-child(1) { animation-delay: 0.05s; }
  .mobile-nav-link:nth-child(2) { animation-delay: 0.1s; }
  .mobile-nav-link:nth-child(3) { animation-delay: 0.15s; }
  .mobile-nav-link:nth-child(4) { animation-delay: 0.2s; }

  @keyframes slideInFromRight {
    from {
      opacity: 0;
      transform: translateX(20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  /* Clase helper para screen readers */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
  }

  /* Mejora de accesibilidad para motion reducido */
  @media (prefers-reduced-motion: reduce) {
    * {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }

  /* Efecto glassmorphism mejorado */
  @supports (backdrop-filter: blur(10px)) {
    #header {
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
  }
</style>

<script>
  // Mobile menu toggle
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  const header = document.getElementById('header');

  if (mobileMenuButton && mobileMenu) {
    mobileMenuButton.addEventListener('click', () => {
      const isExpanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';
      
      mobileMenuButton.setAttribute('aria-expanded', (!isExpanded).toString());
      
      if (isExpanded) {
        // Cerrar menú
        mobileMenu.style.maxHeight = '0px';
        mobileMenu.style.opacity = '0';
      } else {
        // Abrir menú
        mobileMenu.style.maxHeight = mobileMenu.scrollHeight + 'px';
        mobileMenu.style.opacity = '1';
      }
    });

    // Cerrar menú al hacer click en un enlace
    const mobileNavLinks = mobileMenu.querySelectorAll('a[href^="#"]');
    mobileNavLinks.forEach(link => {
      link.addEventListener('click', () => {
        mobileMenuButton.setAttribute('aria-expanded', 'false');
        mobileMenu.style.maxHeight = '0px';
        mobileMenu.style.opacity = '0';
      });
    });

    // Cerrar menú al presionar Escape
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && mobileMenuButton.getAttribute('aria-expanded') === 'true') {
        mobileMenuButton.setAttribute('aria-expanded', 'false');
        mobileMenu.style.maxHeight = '0px';
        mobileMenu.style.opacity = '0';
        mobileMenuButton.focus();
      }
    });

    // Cerrar menú al hacer click fuera
    document.addEventListener('click', (e) => {
      if (mobileMenuButton.getAttribute('aria-expanded') === 'true') {
        if (!header?.contains(e.target as Node)) {
          mobileMenuButton.setAttribute('aria-expanded', 'false');
          mobileMenu.style.maxHeight = '0px';
          mobileMenu.style.opacity = '0';
        }
      }
    });
  }

  // Header scroll effect
  let lastScroll = 0;
  const headerElement = document.getElementById('header');

  window.addEventListener('scroll', () => {
    const currentScroll = window.pageYOffset;
    
    if (headerElement) {
      if (currentScroll > 50) {
        headerElement.classList.add('scrolled');
      } else {
        headerElement.classList.remove('scrolled');
      }
    }
    
    lastScroll = currentScroll;
  }, { passive: true });


// Smooth scroll para enlaces internos
// Smooth scroll para enlaces internos
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', (e) => {
        e.preventDefault();
        const href = anchor.getAttribute('href');
        const target = document.querySelector(href || '');
        
        if (target) {
            const headerOffset = 80; // Altura del header
            const elementPosition = target.getBoundingClientRect().top;
            const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
            
            window.scrollTo({
                top: offsetPosition,
                behavior: 'smooth'
            });
        }
    });
});
// Active link highlighting
const navLinks = document.querySelectorAll('.nav-link, .mobile-nav-link');
const sections = document.querySelectorAll('section[id]');

function highlightActiveLink(): void {
    let current: string = '';
    const scrollPosition: number = window.scrollY + 100;

    sections.forEach((section: Element) => {
        const sectionElement = section as HTMLElement;
        const sectionTop: number = sectionElement.offsetTop;
        const sectionHeight: number = sectionElement.offsetHeight;
        const sectionId: string | null = section.getAttribute('id');

        if (scrollPosition >= sectionTop && scrollPosition < sectionTop + sectionHeight) {
            current = sectionId || '';
        }
    });

    navLinks.forEach((link: Element) => {
        link.classList.remove('active-link');
        const href: string | null = link.getAttribute('href');

        if (href === `#${current}`) {
            link.classList.add('active-link');
        }
    });
}

// Event listeners
window.addEventListener('scroll', highlightActiveLink);
window.addEventListener('load', highlightActiveLink);

  // Throttled scroll para mejor performance
  let ticking = false;
  window.addEventListener('scroll', () => {
    if (!ticking) {
      window.requestAnimationFrame(() => {
        highlightActiveLink();
        ticking = false;
      });
      ticking = true;
    }
  }, { passive: true });

  // Initial check
  highlightActiveLink();
</script>

<style is:global>
  /* Estilos para el link activo */
  .active-link {
    @apply text-yellow-500 bg-yellow-50;
  }

  .active-link span {
    @apply w-10;
  }

  /* Smooth scroll para toda la página */
  html {
    scroll-behavior: smooth;
  }

  @media (prefers-reduced-motion: reduce) {
    html {
      scroll-behavior: auto;
    }
  }
</style>